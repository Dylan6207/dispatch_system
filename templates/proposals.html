<!doctype html>
<html>
<head><title>提案系統</title></head>
<body>
<h1>提案系統</h1>
<p>你好，{{ current_user.username }}！ <a href="{{ url_for('logout') }}">登出</a> | <a href="{{ url_for('dashboard') }}">Performance Dashboard</a></p>

<h2>新增提案</h2>
<form method="post">
  標題: <input type="text" name="title" required><br>
  內容: <textarea name="description"></textarea><br>
  <button type="submit">新增提案</button>
</form>

<h2>提案清單</h2>
<table border="1" cellpadding="5" cellspacing="0">
<tr><th>ID</th><th>標題</th><th>描述</th><th>承接者</th><th>狀態</th><th>動作</th></tr>
{% for p in proposals %}
<tr>
  <td>{{ p.id }}</td>
  <td>{{ p.title }}</td>
  <td>{{ p.description }}</td>
  <td>
    {% if p.claimed_by %}
      {{ users_dict[p.claimed_by] if users_dict[p.claimed_by] else '未知' }}
    {% else %}
      無
    {% endif %}
  </td>
  <td>{{ p.status }}</td>
  <td>
    {% if p.claimed_by is none %}
      <a href="{{ url_for('claim', proposal_id=p.id) }}">搶案</a>
    {% elif p.claimed_by == current_user.id and p.status != 'completed' %}
      <a href="{{ url_for('complete', proposal_id=p.id) }}">標記完成</a>
    {% else %}
      -
    {% endif %}
  </td>
</tr>
{% endfor %}
</table>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>{% for msg in messages %}<li>{{ msg }}</li>{% endfor %}</ul>
  {% endif %}
{% endwith %}
</body>
</html>
