{% extends "base.html" %}
{% block title %}提案總覽{% endblock %}

{% block content %}
<h2>所有提案</h2>

{% if current_user.role == 'admin' %}
    <a href="{{ url_for('proposal_routes.submit_proposal') }}" class="btn btn-success mb-3">➕ 新增提案</a>
{% endif %}

{% if proposals %}
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>標題</th>
                <th>描述</th>
                <th>提案人</th>
                <th>目前承接人</th>
                <th>建立時間</th>
                {% if current_user.role == 'admin' %}
                    <th>操作</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for p in proposals %}
            <tr>
                <td>{{ p.title }}</td>
                <td>{{ p.description }}</td>
                <td>{{ p.created_by or '匿名' }}</td>
                <td>{{ p.claimed_by or '尚未承接' }}</td>
                <td>{{ p.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                {% if current_user.role == 'admin' %}
                <td>
                    <a href="{{ url_for('proposal_routes.edit_proposal', proposal_id=p.id) }}" class="btn btn-sm btn-warning">編輯</a>
                    <form method="post" action="{{ url_for('proposal_routes.delete_proposal', proposal_id=p.id) }}" style="display:inline;" onsubmit="return confirm('確定要刪除這個提案嗎？');">
                        <button type="submit" class="btn btn-sm btn-danger">刪除</button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>目前沒有任何提案。</p>
{% endif %}
{% endblock %}
